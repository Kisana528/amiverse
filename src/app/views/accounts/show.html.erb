<% content_for :main_content do %>
  <% provide(:title, 'アカウント詳細') %>
  <% if @account.present? %>
    <div class="account-container" id="account-container">
      <div class="top-container">
        <div class="banner-container" id="banner-container" >
          <% if !@account.banner_id.blank? %>
            <%= image_tag signed_ati_url(@account.account_id, 'banner', @account.banner_id), class: 'account-banner' %>
          <% else %>
            <%= image_tag 'banner.webp', class: 'account-banner' %>
          <% end %>
        </div>
      </div>
      <div class="name-container" id="name-container">
        <div id="name-before"></div>
        <div class="icon-container">
          <% if !@account.icon_id.blank? %>
            <%= image_tag signed_ati_url(@account.account_id, 'icon', @account.icon_id), class: 'account-icon' %>
          <% else %>
            <%= image_tag 'icon.webp', class: 'account-icon' %>
          <% end %>
        </div>
        <div class="meta-container">
            <h1><%= @account.name %></h1>
            <div>@<%= @account.name_id %></div>
          <%= @account == @current_account ? link_to('編集', edit_account_path) + button_to("Log out", logout_path, method: :delete) : 'フォロー' %>
        </div>
      </div>

      <div class="profile-container">
        <div><span>紹介:</span><%= @account.bio %></div>
        <div><span>場所:</span><%= @account.location %></div>
        <div><span>誕生日:</span><%= @account.birthday&.strftime("%Y年 %m月 %d日") %></div>
        <div><span>フォロワー:</span><%= @account.followers %></div>
        <div><span>フォロー:</span><%= @account.following %></div>
        <div><span>投稿数:</span><%= @account.items_count %></div>
        <div><span>参加日:</span><%= @account.created_at.strftime("%Y年 %m月 %d日") %></div>
      </div>
      <div class="account-tab-container">
        <div>投稿</div>
        <div>返信</div>
        <div>メディア</div>
        <div>リアクション</div>
      </div>
      <div class="content-container">
        <p>開始</p>
        <div id="items">
          <% @account.items.each do |item| %>
            <%= render 'shared/item_account', item: item, reactions: @reactions %>
          <% end %>
        </div>
      </div>
    </div>
  <% else %>
    <p>@<%= params[:name_id] %>というアカウントが見つかりませんでした。。。</p>
  <% end %>
  <script>
  if (document.getElementById('banner-container')) {
  const scrollHandler = () => {
    let elem = document.getElementById('banner-container')
    let scrollY = window.scrollY / 2000 + 1
    if (scrollY > 1.5) scrollY = 1.5
    elem.style.transform = 'scale(' + scrollY + ')'
  }
  window.addEventListener('scroll', scrollHandler)
  const header = document.getElementById('name-container')
  const observer = new IntersectionObserver(entries => {
    for (const entry of entries) {
      if (entry.isIntersecting) {
        header.classList.remove('fixed')
        window.removeEventListener('scroll', scrollHandler)
      } else {
        header.classList.add('fixed')
      }
    }
  })
  observer.observe(document.getElementById('name-before'))
}
  </script>
<% end %>
<%= render 'shared/no_header' %>